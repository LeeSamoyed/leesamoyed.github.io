
## 审计工具
Fortify

!!! note "注意"
		Fortify给的可能漏洞不一定全对，每一次请人工再审核一次，防止业务出现问题。同时逻辑相关的漏洞，软件相对比较难识别嗷！请进行一个人工做审核

## 审计思路

要求:

- 基本保证最重要的功能不存在安全漏洞(重要业务)
- 保证整个系统主要逻辑符合软件相关的安全规定(第三方组件、所有常见可能漏洞，保证安全软件扫描结果、测试部门测试之后所暴露的漏洞等级和数量在安全可控范围)

思路:

- 首先，找到源代码和开发文档，这是两个最直观的公开资料，会暴露各种功能点(逻辑调用、文件下载、文件上传等)，这一步要确定所有功能的梳理、有必要审核的范围等
- 其次，根据使用的第三饭组件进行查看公开漏洞(这种很致命)
- 再次，通过工具审查审核源代码
- 从次，人工审核工具的漏洞，涉及逻辑的漏洞，其他工具的弱项审核漏洞
- 最后，整理
- 先通过文档、源代码正向分析数据流向，映射关系等。再通过第三方组件、框架、接口等逆向分析

## OWASP-Top10

### XSS

1. 通过熟悉代码后快速全局搜索是否存在“xss”、“xssFilter”等，以及是否存在对常见js标签进行黑名单过滤的工具，如果没有，则大概率情况下没有进行XSS漏洞的防御
2. 如果发现存在基于黑名单过滤特殊字符，要去评估黑名单是否完整，也就是说是否基本覆盖常见的危险字符，否则会造成绕过的风险，一般情况下这种修复手段不建议使用
	- 第一存在绕过的可能性
	- 第二过滤请求参数不全面（在没有配置全局过滤器Filter的情况下）
3. 如果配置了全局式的XSS过滤器，需要确定过滤器是否正常开启，否则形同虚设
4. 对于XSS漏洞
	- 情况一：存在一般是全站式XSS，往往是因为开发时没有考虑到对所有参数进行防御
	- 情况二：拥有一定安全经验和以前被披露过XSS漏洞，通过自己的工具仅仅解决了部分参数的XSS漏洞，这种情况也是不完整的（可能配置了全局过滤器，但是范围仅仅局限于某些参数，而非所有前端可控制参数）

## SpringBoot审计

### 整理结构

用户 -> 服务器 -> Filter;Interceptor/Controller/Service;Impl/Dao;Mapper\[通过前后端(主)能看见的部分\] -> 数据库

请求过程分为：

- 服务器 -> Filter;Interceptor Web中间件解析
- Filter;Interceptor -> Controller 过滤、鉴权、拦截
- Controller -> Service;Impl 参数的验证
- Service;Impl -> Dao;Mapper 请求
- Dao;Mapper -> 数据库 操作数据库

因此防护的过程分为：

- 获取参数(@RequestParam; Bean等)
- 参数传递(路由、参数，这一步几乎贯穿上述全部过程)
- 参数坚定(类、参数过滤;强制转换、权限验证等)，例如Python相关的JWT，XSS的检测工具包等

## 奇怪的漏洞增加了

- 第三方包本身存在漏洞(log4j)
- 硬编码(可破解)
- 配置文件可见、可改、可操作
- 随机数不安全(被爆破等)
- 弱口令(员工常犯)

***

推荐一个不错的课程网站[MS08067](https://www.ms08067.com/)

两个不错的审计环境搭建及其环境，下面两份代码上面的教程中有

- XSS-Demo

Maven ｜ 初始页：http://localhost:8080/xss_0618/

![XSS-Demo](/assets/images/cyber-security/code-audit/xss-env.png)

- Hospital

SpringBoot ｜ 初始页：localhost/index ｜ 数据库：isHospital（hospital + hospital1--）

![Hospital](/assets/images/cyber-security/code-audit/hospital-env.png)